---
tags:
- FIFO
- æ•°æ®ç»“æ„  
- STM32 
title: ç†è§£ç¯å½¢é˜Ÿåˆ—
date: 2024-09-14
updated: 
categories:
- è®°å½• 
keywords:
- STM32  
- modbus  
description: 
top_img: 
comments: 
cover: ç¯å½¢.png
toc: 
toc_number: 
toc_style_simple: 
copyright: 
copyright_author: 
copyright_author_href: 
copyright_url: 
copyright_info: 
mathjax: 
katex: 
aplayer: 
highlight_shrink: 
aside: 
swiper_index: 1
top_group_index: 1
background: "#fff"
---

# è§£è¯»ç¯å½¢é˜Ÿåˆ—-Cè¯­è¨€å®ç°  
ç¯å½¢é˜Ÿåˆ—ï¼ˆCircular Queueï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—æ•°æ®ç»“æ„ã€‚ä¸æ™®é€šçš„çº¿æ€§é˜Ÿåˆ—ä¸åŒï¼Œç¯å½¢é˜Ÿåˆ—åœ¨ç‰©ç†å­˜å‚¨ä¸Šè¡¨ç°ä¸ºä¸€ä¸ªé¦–å°¾ç›¸è¿çš„ç¯çŠ¶ç»“æ„ï¼Œåœ¨é€»è¾‘ä¸Šåˆ™ä»ç„¶éµå¾ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFO, First In First Outï¼‰çš„åŸåˆ™ã€‚  
## ç‰¹ç‚¹  
1. **å¾ªç¯åˆ©ç”¨ç©ºé—´**ï¼šå½“é˜Ÿåˆ—ä¸­çš„å…ƒç´ è¢«åˆ é™¤åï¼ŒåŸæ¥çš„ç©ºé—´å¯ä»¥è¢«é‡æ–°ä½¿ç”¨ï¼Œä»è€Œé¿å…äº†æ™®é€šé˜Ÿåˆ—ä¸­å³ä½¿æœ‰ç©ºé—²ç©ºé—´ä¹Ÿæ— æ³•ä½¿ç”¨çš„ç°è±¡ã€‚  
2. **é˜Ÿå¤´é˜Ÿå°¾æŒ‡é’ˆ**ï¼šé€šå¸¸ç¯å½¢é˜Ÿåˆ—ä¼šä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆæ¥æ ‡è¯†é˜Ÿåˆ—çš„å¤´éƒ¨å’Œå°¾éƒ¨ï¼Œåˆ†åˆ«ç§°ä¸ºheadï¼ˆé˜Ÿå¤´æŒ‡é’ˆï¼‰å’Œendï¼ˆé˜Ÿå°¾æŒ‡é’ˆï¼‰ã€‚  
3. **é˜Ÿæ»¡ä¸é˜Ÿç©ºåˆ¤æ–­**ï¼šç”±äºæ˜¯ç¯å½¢ç»“æ„ï¼Œåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å·²æ»¡æˆ–ä¸ºç©ºéœ€è¦ç‰¹æ®Šå¤„ç†ã€‚ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯åœ¨æ•°ç»„å¤§å°ä¸ºNçš„æƒ…å†µä¸‹ï¼Œé¢„ç•™ä¸€ä¸ªä½ç½®ä¸ä½¿ç”¨ï¼Œè¿™æ ·å½“end + 1 == headæ—¶ï¼Œè¡¨ç¤ºé˜Ÿåˆ—å·²æ»¡ï¼›è€Œå½“end == headæ—¶ï¼Œåˆ™è¡¨ç¤ºé˜Ÿåˆ—ä¸ºç©ºæˆ–æ»¡ï¼ˆå–å†³äºå…·ä½“å®ç°æ–¹å¼ï¼‰ã€‚  
4. **åŠ¨æ€è°ƒæ•´**ï¼šåœ¨ä¸€äº›å®ç°ä¸­ï¼Œå¯ä»¥é€šè¿‡åŠ¨æ€è°ƒæ•´æ•°ç»„å¤§å°æ¥é€‚åº”ä¸æ–­å˜åŒ–çš„æ•°æ®é‡ï¼Œä½†è¿™ä¸æ˜¯ç¯å½¢é˜Ÿåˆ—ç‰¹æœ‰çš„æ€§è´¨ï¼Œä¹Ÿå¯ä»¥åº”ç”¨äºå…¶ä»–æ•°æ®ç»“æ„ã€‚  
## åº”ç”¨åœºæ™¯  
ç¯å½¢é˜Ÿåˆ—å› å…¶å¾ªç¯åˆ©ç”¨ç©ºé—´çš„ç‰¹ç‚¹ï¼Œåœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ï¼š  
- ç¼“å†²åŒºç®¡ç†ï¼šåœ¨ç½‘ç»œç¼–ç¨‹æˆ–è€…ç¡¬ä»¶é©±åŠ¨ç¨‹åºä¸­ï¼Œç¯å½¢é˜Ÿåˆ—ç»å¸¸ç”¨äºç®¡ç†å›ºå®šå¤§å°çš„ç¼“å†²åŒºã€‚
- ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œç¯å½¢é˜Ÿåˆ—å¯ä»¥ç”¨ä½œç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¹‹é—´å…±äº«çš„æ•°æ®ç»“æ„ã€‚
- æ»‘åŠ¨çª—å£ç®—æ³•ï¼šåœ¨ç®—æ³•è®¾è®¡ä¸­ï¼Œç¯å½¢é˜Ÿåˆ—å¯ä»¥å¸®åŠ©å®ç°æ»‘åŠ¨çª—å£ç­‰é«˜æ•ˆçš„æ•°æ®å¤„ç†ç­–ç•¥ã€‚
  
å…·ä½“åˆ°stm32ä¸­,å¸¸ç”¨äºä¸²å£æ¥æ”¶,å°†æ•°æ®å­˜å…¥ç¯å½¢fifoå¯ä»¥ä½¿å¾—æ•°æ®å¯ä»¥å¼‚æ­¥çš„ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ”¶å‘é¢‘ç¹çš„ä½¿ç”¨åœºæ™¯ä¸­(å¦‚ä¸²å£è¿æ¥wifiæˆ–è€…4gæ¨¡å—ï¼Œè¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œéœ€è¦ä¿æŒç½‘ç»œä¸€ç›´ä¼ è¾“æœ‰æ•ˆæ•°æ®)ï¼Œå¯ä»¥æœ‰æ•ˆçš„åˆ©ç”¨å•ç‰‡æœºçš„ramç©ºé—´.å¹¶ä¸”æé«˜å•ç‰‡æœºçš„æ‰§è¡Œæ•ˆç‡ã€‚

## å›¾è§£
### éå¾ªç¯é˜Ÿåˆ—  
éå¾ªç¯é˜Ÿåˆ— ä¹Ÿæ˜¯ç”±ä¸€ä¸ªå¤´æŒ‡é’ˆ*head*å’Œä¸€ä¸ªå°¾æŒ‡é’ˆ*end*æ„æˆ,å¹¶ä¸”éµå¾ªä¸¤ä¸ªè§„åˆ™
>1. å¤´æŒ‡é’ˆæŒ‡å‘æ•°æ®å¤´
>2. å°¾æŒ‡é’ˆæŒ‡å‘æ•°æ®å°¾
- **é¦–å…ˆæ¥çœ‹æ€ä¹ˆå…¥é˜Ÿ**
ä¸ºäº†ä¿è¯ç¬¬ä¸€ä¸ªå…¥é˜Ÿçš„æ•°æ®å­˜å‚¨åœ¨ä¸‹æ ‡ä¸º0çš„æ•°ç»„ï¼Œå¹¶ä¸”è¿˜è¦ä¿è¯æ¯æ¬¡å…¥é˜Ÿåå¤´æŒ‡é’ˆè¦åŠ ä¸€åç§»ï¼Œä¸”è¦æ»¡è¶³**è§„åˆ™2**å°¾æŒ‡é’ˆæŒ‡å‘æ•°æ®å°¾ï¼Œæ‰€ä»¥å°¾æŒ‡é’ˆ*end*çš„åˆå§‹å€¼å…³ç³»ä¸ºend+1=0 æ‰€ä»¥endç­‰äº **-1** ï¼Œ
å…¥ä¸‹å›¾æ‰€ç¤º
![1](1.png "endæŒ‡å‘-1")
*end* = *end*+1 = 0
ç„¶åå°†æ•°æ®æ”¾å…¥endæŒ‡å‘çš„åœ°å€ç©ºé—´å°±å®Œæˆäº†ä¸€æ¬¡å…¥é˜Ÿå¦‚ä¸‹å›¾æ‰€ç¤º
![1](2.png "endæŒ‡å‘0")
- **æ€ä¹ˆå‡ºé˜Ÿ**
åšæ³•å°±æ˜¯**å…ˆå°†***head*æŒ‡é’ˆæŒ‡å‘çš„æ•°æ®æŠ›å‡ºï¼Œ**ç„¶å***head*åŠ ä¸€æŒ‡å‘æ•°æ®å¤´**è¿™ä¸ªå…ˆåé¡ºåºæ¯”è¾ƒå…³é”®æ˜¯è·Ÿå¾ªç¯é˜Ÿåˆ—æœ‰åŒºåˆ«çš„**ï¼Œåœ¨ç¬¬ä¸€æ¬¡å‡ºé˜Ÿçš„æ—¶å€™å¿…å®šä¼šå°†ä¸‹æ ‡ä¸º0çš„æ•°æ®æŠ›å‡ºï¼Œç„¶åæŒ‡å‘ä¸‹æ ‡ä¸º1çš„æ•°æ®ã€‚æ‰€ä»¥head+1 = 1 æ‰€ä»¥headçš„åˆå§‹å€¼ä¸º**0**
å‡å¦‚ç°åœ¨é˜Ÿåˆ—ä¸­æœ‰ä¸¤ä¸ªæ•°æ®å…¥ä¸‹å›¾æ‰€ç¤º
![1](3.png "endæŒ‡å‘1 headæŒ‡å‘0")
å‡ºä¸€ä¸ªæ•°æ®å°±æ˜¯å…ˆå°†*head*æŒ‡å‘ç©ºé—´çš„æ•°æ®æŠ›å‡ºå»ä¾›ä½¿ç”¨ï¼Œç„¶å*head*åŠ ä¸€ç§»åˆ°ä¸‹ä¸€ä¸ªå¾…æŠ›å‡ºçš„æ•°æ®ä¸‹æ ‡ä½ç½®å…¥ä¸‹å›¾æ‰€ç¤º
![1](4.png "endæŒ‡å‘1 headæŒ‡å‘1")
- **é‚£ä¹ˆæ€ä¹ˆåˆ¤æ–­é˜Ÿç©ºå‘¢**
  é¦–å…ˆæœ‰ä¸€ä¸ªæ¡ä»¶æ˜¯æˆ‘ä»¬å·²ç»çŸ¥é“çš„å°±æ˜¯å½“*endä¸º-1*æ—¶è¡¨ç¤ºè¿˜æ²¡æœ‰æ•°æ®å…¥é˜Ÿé‚£é˜Ÿåˆ—è‚¯å®šä¸ºç©ºï¼Œç„¶åæˆ‘ä»¬æ¥ç€ä¸Šé¢å†å‡ºä¸€æ¬¡é˜Ÿæ˜¯ä¸æ˜¯æ•°æ®ä¹Ÿå‡ºç©äº†ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æ•ˆæœå§ã€‚
![1](5.png "endæŒ‡å‘1 headæŒ‡å‘2")
æ­¤æ—¶æˆ‘ä»¬å‘ç°*head*æŒ‡é’ˆæ˜¯ä¸æ˜¯æ¯”*end*æŒ‡é’ˆè¿˜å¤§ä¸€å‘€ï¼Œæ‰€ä»¥é˜Ÿç©ºçš„æ¡ä»¶æœ‰ä¸¤æ¡
>1. ***endä¸º -1*** è¡¨ç¤ºé˜Ÿç©º
>2. ***end* + 1 = *head*** è¡¨ç¤ºé˜Ÿç©º

è¿™ä¸ª**é˜Ÿç©ºè§„åˆ™2**åŒæ ·ç¤ºç”¨äºå½“é˜Ÿåˆ—é‡Œåªæœ‰ä¸€ä¸ªæ•°æ®æ—¶çš„æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤º
![1](6.png "endæŒ‡å‘0 headæŒ‡å‘0")
æ­¤æ—¶é˜Ÿåˆ—é‡Œæœ‰ä¸€ä¸ªæ•°æ®ï¼Œç„¶åå‡ºé˜Ÿä¸€ä¸ªæ•°æ®æ»¡è¶³**é˜Ÿç©ºè§„åˆ™2**å¦‚ä¸‹å›¾æ‰€ç¤º
![1](7.png "endæŒ‡å‘0 headæŒ‡å‘1")
- **é‚£ä¹ˆæ€ä¹ˆåˆ¤æ–­é˜Ÿæ»¡å‘¢**
åœ¨éå¾ªç¯é˜Ÿåˆ—ä¸­è§„åˆ™å¾ˆç®€å•å°±ä¸€æ¡
>1. ***end* + 1 = MAX_SIZE** //å…¶ä¸­*MAX_SIZE*æ˜¯é˜Ÿåˆ—çš„æœ€å¤§å­˜å‚¨ä¸ªæ•°  

ä¸‹å›¾è¡¨ç¤ºé˜Ÿæ»¡
![1](8.png "endæŒ‡å‘0 headæŒ‡å‘6")
ä½†æ˜¯æˆ‘ä»¬ä¼šå‘ç°ä¸‹å›¾ä¹Ÿè¡¨ç¤ºé˜Ÿæ»¡
![1](9.png "endæŒ‡å‘2 headæŒ‡å‘6")
å…¶ä¸­ 0 1 2 è¿™äº›ä½ç½®ç©ºç€ä¹Ÿæ— æ³•ä½¿ç”¨ï¼Œè¿™å°±æ˜¯éå¾ªç¯é˜Ÿåˆ—æœ€å¤§çš„ç¼ºç‚¹ä¸èƒ½å……åˆ†åˆ©ç”¨ç©ºé—´ã€‚
### å¾ªç¯é˜Ÿåˆ—  
å¾ªç¯é˜Ÿåˆ— åŒæ ·ä¹Ÿæ˜¯ç”±ä¸€ä¸ªå¤´æŒ‡é’ˆ*head*å’Œä¸€ä¸ªå°¾æŒ‡é’ˆ*end*æ„æˆ,ä½†æ˜¯éµå¾ªä¸¤ä¸ªè§„åˆ™ä¸­å¤´æŒ‡é’ˆå¹¶ä¸æŒ‡å‘æ•°æ®å¤´è€Œæ˜¯æŒ‡å‘ä¸Šä¸€æ¬¡è¢«åˆ é™¤çš„æ•°æ®åœ°å€ã€‚
>1. å¤´æŒ‡é’ˆæŒ‡å‘ä¸Šä¸€æ¬¡è¢«åˆ é™¤çš„æ•°æ®åœ°å€
>2. å°¾æŒ‡é’ˆæŒ‡å‘æ•°æ®å°¾
- **æ€ä¹ˆå®ç°ä¸‹æ ‡åœ¨è®¾å®šèŒƒå›´ç§»åŠ¨**
å‡å¦‚ä¸€ä¸ªé˜Ÿåˆ—çš„å¯å­˜å‚¨æ•°æ®ä¸ªæ•°**MAX_SIZE**=7é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ä¸ªå…¬å¼ä½¿å¾—è®©æŒ‡é’ˆä¸€ç›´åŠ ä¸€ï¼Œä½†æ˜¯å¯ä»¥è®©æŒ‡é’ˆä¿æŒåœ¨**0~6**è¿™ä¸ªåŒºé—´
>***end = (end+1)%MAX_SIZE***
>***haed = (head+1)%MAX_SIZE***
- **å¾ªç¯é˜Ÿåˆ—å…¥é˜Ÿ**
å…¶æ“ä½œé€»è¾‘å’Œéå¾ªç¯é˜Ÿåˆ—ä¸€æ · ä½†æ˜¯èµ·å§‹ä¸‹æ ‡ä¸º**0**
>1. end åŠ ä¸€
>2. æŠŠæ•°æ®å­˜å…¥endæŒ‡å‘çš„æ•°æ®ç©ºé—´

å…¥é˜Ÿä¸€ä¸ªæ•°æ®å¦‚ä¸‹å›¾æ‰€ç¤º ç¬¬ä¸€ä¸ªæ•°æ®å­˜åœ¨äº†1å·ä¸‹æ ‡
![1](10.png "endæŒ‡å‘1 headæŒ‡å‘0")
   
- **å¾ªç¯é˜Ÿåˆ—å‡ºé˜Ÿ**
è¿™ä¸€ç‚¹é¡ºåºå’Œéå¾ªç¯é˜Ÿäº†ç›¸å ä½†èµ·å§‹ä¸‹æ ‡ä¹Ÿä¸º**0**

>1. head åŠ ä¸€
>2. æŠŠheadæŒ‡å‘çš„æ•°æ®ç©ºé—´çš„æ•°æ®æŠ›å‡º

åœ¨é˜Ÿåˆ—æœ‰2ä¸ªæ•°æ®æ—¶å‡ºé˜Ÿä¸€ä¸ªæ•°æ®ï¼Œå¯ä»¥å‘ç°æ­¤æ—¶headæŒ‡å‘çš„æ•°æ®ç©ºé—´å¹¶çš„æ•°æ®å·²ç»è¢«æŠ›å‡ºè¿‡ã€‚
![1](11.png "endæŒ‡å‘2 headæŒ‡å‘1")
- **å¾ªç¯é˜Ÿåˆ—åˆ¤æ–­é˜Ÿæ»¡**
åœ¨ä¸‹å›¾è¿™ç§æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯ä¸€ç›´å…¥é˜Ÿåˆ°**MAX_SIZE -1**çš„ä¸‹æ ‡å¹¶ä¸”æ²¡æœ‰å‡ºé˜Ÿï¼Œè™½ç„¶0å·ä¸‹æ ‡æ˜¯ç©ºçš„ï¼Œä½†æ­¤æ—¶æˆ‘ä»¬ä¹Ÿè®¤ä¸ºé˜Ÿæ»¡äº†ã€‚
![1](12.png "endæŒ‡å‘6 headæŒ‡å‘0")
è¿™ç§é˜Ÿæ»¡çš„è§„åˆ™å¯ä»¥æ€»ç»“ä¸º
>**head = (end+1)%MAX_SIZE**

é‚£è¿™ç§æƒ…å†µé€‚ç”¨äºå…¶å®ƒæƒ…å†µå—ï¼Œæ¯”å¦‚head end äº§ç”Ÿå¾ªç¯ä¸åœ¨å¤´å°¾çš„æ—¶å€™
![1](13.png "endæŒ‡å‘2 headæŒ‡å‘3")
å¯ä»¥å‘ç°è¿™ä¸ªè§„åˆ™åŒæ ·é€‚ç”¨
- **å¾ªç¯é˜Ÿåˆ—åˆ¤æ–­é˜Ÿç©º**
é¦–å…ˆåœ¨æ²¡æœ‰ä»»ä½•å‡ºé˜Ÿå…¥é˜Ÿçš„æƒ…å†µä¸‹
>1. head = 0 ;
>2. end = 0 ;

æ‰€ä»¥é˜Ÿç©ºçš„è§„åˆ™æ˜¯ 

> **head == end**

åœ¨æœ‰äº†é˜Ÿåˆ—æ“ä½œè¿‡åè¿™ä¸ªè§„åˆ™è¿˜æ»¡è¶³å—ï¼Ÿæ¯”å¦‚åœ¨å…¥é˜Ÿ4ä¸ªæ•°æ®åå‡ºé˜Ÿå››ä¸ªæ•°æ®
å…ˆå…¥é˜Ÿ4ä¸ªæ•°æ®å…¥ä¸‹å›¾
![1](14.png "endæŒ‡å‘4 headæŒ‡å‘0")
ç„¶åå‡ºé˜Ÿ4ä¸ªæ•°æ®
![1](15.png "endæŒ‡å‘4 headæŒ‡å‘4")
æˆ‘ä»¬å‘ç°è¿™ä¸ªè§„åˆ™åŒæ ·é€‚ç”¨ï¼Œé‚£æˆ‘ä»¬åœ¨ç»§ç»­å…¥é˜Ÿçœ‹çœ‹äº§ç”Ÿå¾ªç¯åè¿˜æ»¡è¶³å—
é¦–å…ˆå…¥é˜Ÿ5ä¸ªæ•°æ®
![1](16.png "endæŒ‡å‘2 headæŒ‡å‘4")
ç„¶åå‡ºé˜Ÿ5ä¸ªæ•°æ®
![1](17.png "endæŒ‡å‘2 headæŒ‡å‘2")
å‘ç°åœ¨äº§ç”Ÿå¾ªç¯åè¿™ä¸ªè§„åˆ™ä¸€æ ·é€‚ç”¨

å½“ç„¶ä½ ä¹Ÿå¯ä»¥å°è¯•å°†**å¾ªç¯é˜Ÿåˆ—å‡ºé˜Ÿ**çš„è§„åˆ™æ”¹ä¸º**éå¾ªç¯é˜Ÿåˆ—å‡ºé˜Ÿ**çš„è§„åˆ™æ¥è¯•è¯•çœ‹ï¼Œä½ ä¼šå‘ç°åˆ¤æ–­é˜Ÿç©ºçš„è§„åˆ™å’Œåˆ¤æ–­é˜Ÿæ»¡çš„è§„åˆ™å°±å˜å¾—ä¸€æ ·äº†éƒ½æ˜¯**head = (end+1)%MAX_SIZE**ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¾ªç¯é˜Ÿåˆ—éœ€è¦ç•™å‡ºä¸€ä¸ªç©ºä½ç½®ä¸ç”¨çš„åŸå› äº†ï¼Œä¸»è¦å°±æ˜¯ä¸ºäº†ä½¿é˜Ÿç©ºå’Œé˜Ÿæ»¡çš„è§„åˆ™å˜å¾—ä¸åŒï¼Œä»è€Œåœ¨ç¨‹åºä¸­æ‰å¥½è¿›è¡Œåˆ¤æ–­

## å®ç°  

å½“ç„¶æ˜¯ä½¿ç”¨cè¯­è¨€æ¥å®ç°é‚£ï¼Œæ¯•ç«Ÿæ˜¯è¦ç”¨åœ¨å•ç‰‡æœºä¸Šè·‘çš„å‘€äº†ğŸ’˜  

### å®šä¹‰ç¯å½¢Fifoæ•°æ®ç»“æ„
- **Max_Size** ï¼šé˜Ÿåˆ—çš„ç©ºé—´ä¸ªæ•° è¿™é‡Œä½¿ç”¨å®å®šä¹‰ä»¥åæ–¹ä¾¿æ›´æ”¹
  
---

- **head** ï¼šå¤´æŒ‡é’ˆæŒ‡å‘é˜Ÿå¤´
- **end**  ï¼šå°¾æŒ‡é’ˆæŒ‡å‘é˜Ÿå°¾
- **data**[Max_Size] ï¼šå®šä¹‰çš„æ•°æ®buff

Cè¯­è¨€ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹
```c
    //é˜Ÿåˆ—å¯ç”¨å®¹é‡ä¸ºæœ€å¤§é•¿åº¦å‡ä¸€ 
    #define Max_Size (10)
    typedef struct
    {
        uint32_t head;
        uint32_t end;
        uint8_t data[Max_Size];
    } Fifo_t;
```
### å‡ºé˜Ÿå…¥é˜ŸåŠæ»¡ç©ºåˆ¤æ–­
åœ¨å†™ç¨‹åºå‰æˆ‘ä»¬å…ˆå°†æ¯ä¸€ä¸ªå°çš„æ­¥éª¤æ¢³ç†æ¸…æ¥šï¼Œé‚£å†™æ•´ä½“ç¨‹åºæ—¶å°±å¯ä»¥é›†é½é¾™ç æ¥å¬å”¤ç¥é¾™äº†ğŸ˜
- ä¸ºäº†ç†è§£æ–¹ä¾¿åŠ å…¥è¾“å…¥å’Œè¾“å‡ºå˜é‡ã€‚
```c
in  //å…¥é˜Ÿçš„æ•°æ®
out //å‡ºé˜Ÿçš„æ•°æ®
```
- é˜Ÿåˆ—åˆå§‹åŒ–ï¼šhead =0 ï¼›end =0ï¼›
```c
head =0 ï¼›
end =0ï¼›
```
- å…¥é˜Ÿæ–¹å¼:å…ˆendæŒ‡é’ˆåŠ 1ï¼ŒåæŠŠinçš„æ•°æ®èµ‹å€¼ç»™endæŒ‡å‘çš„ç©ºé—´ï¼›ä¸ºäº†ä¿è¯èŒƒå›´åœ¨0~Max_Size é‡‡ç”¨å–ä½™çš„æ–¹å¼ã€‚
```c
end = (end+1)%Max_Size;
data[end] = in;
```
- å‡ºé˜Ÿæ–¹å¼:å…ˆheadæŒ‡é’ˆåŠ 1ï¼ŒåæŠŠheadæŒ‡å‘çš„ç©ºé—´æ•°æ®èµ‹å€¼ç»™outï¼›ä¸ºäº†ä¿è¯headèŒƒå›´åœ¨0~Max_Size é‡‡ç”¨å–ä½™çš„æ–¹å¼ã€‚
```c
head = (head+1)%Max_Size;
out = data[head];
```
- é˜Ÿæ»¡åˆ¤æ–­: end+1 == head  ï¼›ä¸ºäº†ä¿è¯endèŒƒå›´åœ¨0~Max_Size é‡‡ç”¨å–ä½™çš„æ–¹å¼ã€‚
```c
(end+1)%Max_Size == head
```
- é˜Ÿç©ºåˆ¤æ–­: end == headã€‚
```c
end == head;
```
è‡³æ­¤æ‰€æœ‰é¾™ç å·²ç»æ”¶é›†åˆ°ä½ğŸŒ
### åˆå§‹åŒ–å‡½æ•°
è¿™ä¸ªç›´æ¥æŠ„
```c
void FifoInit(Fifo_t *f)
{
    f->end = 0;
    f->head = 0;
}
```
### åˆ¤æ–­é˜Ÿåˆ—ç©ºå‡½æ•°
æŠ„
```c
uint8_t isEmpty(Fifo_t *f)
{
    return (f->end == f->head);
}
```
### åˆ¤æ–­é˜Ÿåˆ—æ»¡å‡½æ•°
æŠ„,ä¸å°±æ˜¯æŠ„å…¬å¼å—...ğŸ˜‚
```c
uint8_t isFull(Fifo_t *f)
{
    return ((f->end + 1) % Max_Size == f->head);
}
```

### å…¥é˜Ÿå‡½æ•°
è¿™ä¸ªç»ˆäºæœ‰ç‚¹å‘æŒ¥ç©ºé—´äº†
```c
/**
 * @brief å…¥é˜Ÿå‡½æ•°
 * @param Fifo_t *f é˜Ÿåˆ—ç»“æ„ä½“æŒ‡é’ˆ
 * @param uint8_t *in å…¥é˜Ÿæ•°æ®æŒ‡é’ˆ
 * @param uint8_t *in å…¥é˜Ÿæ•°æ®é•¿åº¦
 * @retval 0 è¡¨ç¤ºé˜Ÿåˆ—æ»¡äº† å…¶å®ƒæ•°å­—è¡¨ç¤ºæˆåŠŸå…¥é˜Ÿçš„æ•°æ®ä¸ªæ•°
 */
uint32_t FifoIn(Fifo_t *f, uint8_t *in, uint32_t len)
{
    uint32_t i;
    for (i = 0; i < len; i++)
    {
        if (isFull(f))
        {
            printf(" in: %d å…¥é˜Ÿå¤±è´¥\n", in[i]);
            return 0;
        }
        f->end = (f->end + 1) % Max_Size;
        f->data[f->end] = in[i];

        printf("in: %d\n", in[i]);
    }

    return i;
}
```
### å‡ºé˜Ÿå‡½æ•°
ç»§ç»­
```c
/**
 * @brief å‡ºé˜Ÿå‡½æ•°
 * @param Fifo_t *f é˜Ÿåˆ—ç»“æ„ä½“æŒ‡é’ˆ
 * @param uint8_t *out å‡ºé˜Ÿæ•°æ®æŒ‡é’ˆ
 * @param uint32_t len å‡ºé˜Ÿæ•°æ®é•¿åº¦
 * @retval 0 è¡¨ç¤ºé˜Ÿåˆ—ç©ºäº†æ²¡æ•°æ®é‡å‡ºé˜Ÿå¤±è´¥ å…¶å®ƒæ•°å­—è¡¨ç¤ºæˆåŠŸå‡ºé˜Ÿçš„æ•°æ®ä¸ªæ•°
 */
uint8_t FifoOut(Fifo_t *f, uint8_t *out, uint32_t len)
{
    uint32_t i;
    for (i = 0; i < len; i++)
    {
        if (isEmpty(f))
        {
            printf("å‡ºé˜Ÿå¤±è´¥\n");
            return 0;
        }
        f->head = (f->head + 1) % Max_Size;
        out[i] = f->data[f->head];
        printf("out: %d\n", out[i]);
    }
    return i;
}
```
### ç¨‹åºéªŒè¯
å†™äº†ç¨‹åºè¦éªŒè¯ï¼Œå¾—æœ‰å§‹æœ‰ç»ˆğŸ˜Šã€‚éªŒè¯ç»“æœéå¸¸å®Œç¾okäº†
```c
static Fifo_t g_fifo;

int main(void)
{
    FifoInit(&g_fifo);

    uint8_t in[10] = {1,2,3,4,5,6,7,8,9,10};
    uint8_t out[10] = {0};
    
    //å…¥é˜Ÿ 3ä¸ªæ•°æ® 1 2 3
    FifoIn(&g_fifo,in,3);

    //å‡ºé˜Ÿ 2ä¸ªæ•°æ® 1 2
    FifoOut(&g_fifo,out,2);

    //å…¥é˜Ÿ 4 5 6 7 8 æ­¤æ—¶é˜Ÿåˆ—é‡Œå³6ä¸ªæ•°æ®
    FifoIn(&g_fifo,&in[3],5);

    //å‡ºé˜Ÿé˜Ÿ2ä¸ªæ•°æ® åº”è¯¥æ˜¯ 3 4 æ­¤æ—¶é˜Ÿåˆ—é‡Œæœ‰4 ä¸ªæ•°æ®
    FifoOut(&g_fifo,out,2);

    //å…¥é˜Ÿ6 ä¸ªæ•°æ® 1 2 3 4 5 6   æ­¤æ—¶é˜Ÿåˆ—é‡Œæœ‰ 10 ä¸ªæ•°æ® 
    //ä½†æ˜¯æœ€åä¸€ä¸ªæ•°æ®ä¼š å…¥é˜Ÿå¤±è´¥ä¸€æ¬¡  å› ä¸ºé˜Ÿåˆ—çš„æœ€å¤§å®¹é‡ä¸ºMax_Size -1 == 9ã€‚ 
    FifoIn(&g_fifo,&in[0],6);


    //å‡ºé˜Ÿ8 ä¸ªæ•°æ®åº”è¯¥æ˜¯  5 6 7 8 1 2 3 4 æ­¤æ—¶é˜Ÿåˆ—é‡Œæœ‰ 1 ä¸ªæ•°æ® 
    FifoOut(&g_fifo,out,8);

    //å‡ºé˜Ÿ2 ä¸ªæ•°æ®åº”è¯¥æ˜¯ 5 ç„¶åé˜Ÿåˆ—ç©º å‡ºé˜Ÿå¤±è´¥ä¸€æ¬¡
    FifoOut(&g_fifo,out,8);

    return 0;
}
```
ç¨‹åºè¿è¡Œç»“æœå’Œæˆ‘å†™éªŒè¯ç¨‹åºæ—¶çš„æ³¨é‡Šä¸€è‡´ï¼Œå¦‚å›¾æ‰€ç¤º
![é˜Ÿåˆ—éªŒè¯](é˜Ÿåˆ—éªŒè¯.png "éªŒè¯ä¸€è‡´")

ä¸‹é¢é™„ä¸Šå®Œæ•´æºç äº†ğŸ™Œ
```c

/* ç¯å½¢é˜Ÿåˆ— è§„åˆ™è¯´æ˜
head å¤´æŒ‡é’ˆæŒ‡å‘é˜Ÿå¤´
end  å°¾æŒ‡é’ˆæŒ‡å‘é˜Ÿå°¾
Max_Size é˜Ÿåˆ—çš„ç©ºé—´ä¸ªæ•°
data[Max_Size] å®šä¹‰çš„æ•°æ®buff


in  å…¥é˜Ÿçš„æ•°æ®
out å‡ºé˜Ÿçš„æ•°æ®

é˜Ÿåˆ—åˆå§‹åŒ–ï¼šhead =0 ï¼›end =0ï¼›

å…¥é˜Ÿæ–¹å¼:å…ˆendæŒ‡é’ˆåŠ 1ï¼ŒåæŠŠinçš„æ•°æ®èµ‹å€¼ç»™endæŒ‡å‘çš„ç©ºé—´ï¼›ä¸ºäº†ä¿è¯èŒƒå›´åœ¨0~Max_Size é‡‡ç”¨å–ä½™çš„æ–¹å¼

    end = (end+1)%Max_Size;
    data[end] = in;

å‡ºé˜Ÿæ–¹å¼:å…ˆheadæŒ‡é’ˆåŠ 1ï¼ŒåæŠŠheadæŒ‡å‘çš„ç©ºé—´æ•°æ®èµ‹å€¼ç»™outï¼›ä¸ºäº†ä¿è¯headèŒƒå›´åœ¨0~Max_Size é‡‡ç”¨å–ä½™çš„æ–¹å¼

    head = (head+1)%Max_Size;
    out = data[head];

é˜Ÿæ»¡åˆ¤æ–­: end+1 == head  ï¼›ä¸ºäº†ä¿è¯endèŒƒå›´åœ¨0~Max_Size é‡‡ç”¨å–ä½™çš„æ–¹å¼

    (end+1)%Max_Size == head

é˜Ÿç©ºåˆ¤æ–­: end == head ï¼›

     end == headï¼›

*/
#include "stdio.h"
#include "stdint.h"

//é˜Ÿåˆ—å¯ç”¨å®¹é‡ä¸ºæœ€å¤§é•¿åº¦å‡ä¸€ 
#define Max_Size (10)

typedef struct
{
    uint32_t head;
    uint32_t end;
    uint8_t data[Max_Size];
} Fifo_t;

void FifoInit(Fifo_t *f)
{
    f->end = 0;
    f->head = 0;
}

uint8_t isEmpty(Fifo_t *f)
{
    return (f->end == f->head);
}

uint8_t isFull(Fifo_t *f)
{
    return ((f->end + 1) % Max_Size == f->head);
}

/**
 * @brief å…¥é˜Ÿå‡½æ•°
 * @param Fifo_t *f é˜Ÿåˆ—ç»“æ„ä½“æŒ‡é’ˆ
 * @param uint8_t *in å…¥é˜Ÿæ•°æ®æŒ‡é’ˆ
 * @param uint32_t len å…¥é˜Ÿæ•°æ®é•¿åº¦
 * @retval 0 è¡¨ç¤ºé˜Ÿåˆ—æ»¡äº†å­˜ä¸ä¸‹äº†å…¥é˜Ÿå¤±è´¥ å…¶å®ƒæ•°å­—è¡¨ç¤ºæˆåŠŸå…¥é˜Ÿçš„æ•°æ®ä¸ªæ•°
 */
uint32_t FifoIn(Fifo_t *f, uint8_t *in, uint32_t len)
{
    uint32_t i;
    for (i = 0; i < len; i++)
    {
        if (isFull(f))
        {
            printf(" in: %d å…¥é˜Ÿå¤±è´¥\n", in[i]);
            return 0;
        }
        f->end = (f->end + 1) % Max_Size;
        f->data[f->end] = in[i];

        printf("in: %d\n", in[i]);
    }

    return i;
}


/**
 * @brief å‡ºé˜Ÿå‡½æ•°
 * @param Fifo_t *f é˜Ÿåˆ—ç»“æ„ä½“æŒ‡é’ˆ
 * @param uint8_t *out å‡ºé˜Ÿæ•°æ®æŒ‡é’ˆ
 * @param uint32_t len å‡ºé˜Ÿæ•°æ®é•¿åº¦
 * @retval 0 è¡¨ç¤ºé˜Ÿåˆ—ç©ºäº†æ²¡æ•°æ®é‡å‡ºé˜Ÿå¤±è´¥ å…¶å®ƒæ•°å­—è¡¨ç¤ºæˆåŠŸå‡ºé˜Ÿçš„æ•°æ®ä¸ªæ•°
 */
uint8_t FifoOut(Fifo_t *f, uint8_t *out, uint32_t len)
{
    uint32_t i;
    for (i = 0; i < len; i++)
    {
        if (isEmpty(f))
        {
            printf("å‡ºé˜Ÿå¤±è´¥\n");
            return 0;
        }
        f->head = (f->head + 1) % Max_Size;
        out[i] = f->data[f->head];
        printf("out: %d\n", out[i]);
    }
    return i;
}


static Fifo_t g_fifo;

int main(void)
{
    FifoInit(&g_fifo);

    uint8_t in[10] = {1,2,3,4,5,6,7,8,9,10};
    uint8_t out[10] = {0};
    
    //å…¥é˜Ÿ 3ä¸ªæ•°æ® 1 2 3
    FifoIn(&g_fifo,in,3);

    //å‡ºé˜Ÿ 2ä¸ªæ•°æ® 1 2
    FifoOut(&g_fifo,out,2);

    //å…¥é˜Ÿ 4 5 6 7 8 æ­¤æ—¶é˜Ÿåˆ—é‡Œå³6ä¸ªæ•°æ®
    FifoIn(&g_fifo,&in[3],5);

    //å‡ºé˜Ÿé˜Ÿ2ä¸ªæ•°æ® åº”è¯¥æ˜¯ 3 4 æ­¤æ—¶é˜Ÿåˆ—é‡Œæœ‰4 ä¸ªæ•°æ®
    FifoOut(&g_fifo,out,2);

    //å…¥é˜Ÿ6 ä¸ªæ•°æ® 1 2 3 4 5 6   æ­¤æ—¶é˜Ÿåˆ—é‡Œæœ‰ 10 ä¸ªæ•°æ® 
    //ä½†æ˜¯æœ€åä¸€ä¸ªæ•°æ®ä¼š å…¥é˜Ÿå¤±è´¥ä¸€æ¬¡  å› ä¸ºé˜Ÿåˆ—çš„æœ€å¤§å®¹é‡ä¸ºMax_Size -1 == 9ã€‚ 
    FifoIn(&g_fifo,&in[0],6);


    //å‡ºé˜Ÿ8 ä¸ªæ•°æ®åº”è¯¥æ˜¯  5 6 7 8 1 2 3 4 æ­¤æ—¶é˜Ÿåˆ—é‡Œæœ‰ 1 ä¸ªæ•°æ® 
    FifoOut(&g_fifo,out,8);

    //å‡ºé˜Ÿ2 ä¸ªæ•°æ®åº”è¯¥æ˜¯ 5 ç„¶åé˜Ÿåˆ—ç©º å‡ºé˜Ÿå¤±è´¥ä¸€æ¬¡
    FifoOut(&g_fifo,out,8);

    return 0;
}
```
